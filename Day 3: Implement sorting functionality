#include <bits/stdc++.h>
#include <signal.h>
using namespace std;


struct P4{int pid; string name; unsigned long cpu; long rss;};


vector<P4> snapshot(){ vector<P4> out; DIR *d = opendir("/proc"); if(!d) return out; struct dirent *e; while((e=readdir(d))){ if(e->d_type!=DT_DIR) continue; string s = e->d_name; if(!all_of(s.begin(), s.end(), ::isdigit)) continue; int pid=stoi(s); string statp = "/proc/"+s+"/stat"; ifstream fs(statp); if(!fs) continue; string line; getline(fs,line); size_t p1=line.find('('), p2=line.rfind(')'); string comm = (p1!=string::npos && p2!=string::npos)? line.substr(p1+1,p2-p1-1):""; string after=line.substr(p2+2); stringstream ss(after); vector<string> t; string tok; while(ss>>tok) t.push_back(tok); unsigned long ut=0, st=0; long rss_pages=0; if(t.size()>=15){ ut=stoul(t[13]); st=stoul(t[14]); if(t.size()>=23) rss_pages=stol(t[21]); } long page_kb=sysconf(_SC_PAGESIZE)/1024; long rss_kb=rss_pages*page_kb; out.push_back({pid,comm,ut+st,rss_kb}); } closedir(d); return out; }


int main(){
cout<<"Day4 - Kill processes (interactive)"<<"\n";
auto procs = snapshot(); sort(procs.begin(), procs.end(), [](auto &a, auto &b){ return a.cpu>b.cpu; });
cout<<left<<setw(8)<<"PID"<<setw(30)<<"NAME"<<setw(12)<<"CPU_TICKS"<<setw(12)<<"RSS_kB"<<"\n";
for(size_t i=0;i<min<size_t>(procs.size(),50);++i){ auto &p=procs[i]; cout<<left<<setw(8)<<p.pid<<setw(30)<<p.name<<setw(12)<<p.cpu<<setw(12)<<p.rss<<"\n"; }
cout<<"\nEnter PID to signal (or 0 to exit): "; int pid; if(!(cin>>pid) || pid==0) return 0; cout<<"Signal number to send (e.g. 15=TERM,9=KILL): "; int sig; cin>>sig; if(kill(pid, sig)==0) cout<<"Signal sent.\n"; else perror("kill");
return 0;
}
